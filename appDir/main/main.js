"use strict";const a=require("electron"),f=require("path"),{ipcMain:d,BrowserWindow:w}=require("electron"),g=()=>{d.on("window-min",r=>{const n=r.sender;w.fromWebContents(n).minimize()}),d.on("window-max",r=>{const n=r.sender,i=w.fromWebContents(n);i.isMaximized()?i.unmaximize():i.maximize()}),d.on("window-close",r=>{const n=r.sender;w.fromWebContents(n).close()})},W=require("path"),c=class o{constructor(){this.getWindowById=n=>a.BrowserWindow.fromId(n),this.defaultConfig={id:null,title:"",width:null,height:null,minWidth:null,minHeight:null,route:"",resizable:!0,maximize:!1,backgroundColor:"#eee",data:null,isMultiWindow:!1,isMainWin:!1,parentId:null,modal:!1},this.defaultOptions={width:900,height:700,center:!0,frame:!1,show:!0,transparent:!0,maxWidth:null,maxHeight:null,minWidth:688,minHeight:560,backgroundColor:"rgba(0,0,0,0)",autoHideMenuBar:!0,resizable:!0,minimizable:!0,maximizable:!0,modal:!0,webPreferences:{contextIsolation:!0,webSecurity:!1,nodeIntegration:!0,preload:W.join(__dirname,"../preload/preload.js")}}}createWindow(n,i){if(console.info(o.group),o.group.some(p=>p.route===n.route)){console.info("window is created");return}let t=Object.assign({},this.defaultConfig,n),h=Object.assign({},this.defaultOptions,i),e=new a.BrowserWindow(h);console.log("window id:"+e.id),o.group[e.id-1]={windowId:e.id,route:t.route},t.maximize&&t.resizable&&e.maximize(),t.isMainWin&&(o.main&&(console.log("主窗口存在"),delete o.group[o.main.id],o.main.close()),o.main=e),e.on("close",()=>e.setOpacity(0));let l;a.app.isPackaged?e.loadFile(f.join(__dirname,"../../dist/index.html"),{hash:t.route}):(l=t.route?`http://localhost:${process.env.VITE_DEV_SERVER_PORT}/#${t.route}`:`http://localhost:${process.env.VITE_DEV_SERVER_PORT}/#`,e.loadURL(l)),console.info("new window address -> ",l),e.setMenu(null),e.webContents.openDevTools(),a.globalShortcut.register("CommandOrControl+Shift+i",function(){e.webContents.openDevTools()}),e.once("ready-to-show",()=>{e.show()})}};c.group=[];c.main=null;let m=c;const{app:s,protocol:b,BrowserWindow:C,ipcMain:x}=require("electron");require("path");g();x.on("window-create",(r,n,i)=>{new m().createWindow(n,i)});const u=async()=>{new m().createWindow({route:"/home",isMainWin:!0},{width:900,height:700})};s.commandLine.appendSwitch("--ignore-certificate-errors","true");b.registerSchemesAsPrivileged([{scheme:"app",privileges:{secure:!0,standard:!0}}]);s.whenReady().then(()=>{u(),s.on("activate",()=>{C.getAllWindows().length===0&&u()})});s.on("window-all-closed",()=>{process.platform!=="darwin"&&s.quit()});
